---
layout:     post 
title:      KubeEdge 部署 
subtitle:   KubeEdge 云端及边缘节点部署 
date:       2021-05-17 
author:     Haorong
header-img: img/post-bg-cook.jpg 
catalog: true 
tags:
- Cloud Computing 
- Edge Computing
---

## 前言

在参照 [KubeEdge 官方文档](https://kubeedge.io/en/docs/setup/keadm/) 进行部署时，发现文档有很多没有说清楚的地方，比如 `keadm` 这个工具是怎么获取的，同时也省略了所有原生
Docker 与 Kubernetes 的部署，对没有接触过这些组件的开发者不太友好，所以写了这篇比较详细的文章，希望能帮助“后人”少踩一点坑。

## Docker 环境配置

参考 [Docker 官方文档](https://docs.docker.com/engine/install/) ，选择对应的操作系统版本。

## Kubernetes 环境配置

### 配置 Kubernetes 源

```shell
# 转到root用户
su
# 这里用的是阿里镜像源
echo "deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main" > /etc/apt/source.list.d/kubernetes.list
apt update

# 如果apt update时报错
# W: GPG error: https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial InRelease: 
# The following signatures couldn't be verified because the public key is not available: 
# NO_PUBKEY XXXXXXXXXXXXXXXX NO_PUBKEY YYYYYYYYYYYYYYYY
apt install gpg
gpg --keyserver keyserver.ubuntu.com --recv {XXXXXXXXXXXXXXXX, YYYYYYYYYYYYYYYY}
gpg --export --armor XXXXXXXXXXXXXXXX | apt-key add -
gpg --export --armor YYYYYYYYYYYYYYYY | apt-key add -
apt update
```

### 安装 kubeadm, kubectl, kubelet

```shell
apt install kubeadm kubectl kubelet
# 检查安装是否成功，版本是否一致
kubeadm version
kubectl version
kubelet --version
```

### 使用 kubeadm 初始化 Kubernetes

```shell
kubeadm init --kubernetes-version=<K8S_VERSION> --apiserver-advertise-address=<MASTER IP> --image-repository registry.aliyuncs.com/google_containers --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16
```

其中，将 `<MASTER IP>` 替换为 master 节点的IP地址，kubernetes-version 与之前安装的 kubeadm 等软件版本一致。初始化成功之后会出现执行 `kubeadm join` 加入节点的提示，这里我们不需要通过这种方式加入节点。

注意 Kubernetes 的 Master 节点服务器必须拥有两个及以上的 CPU Cores，否则无法部署。

